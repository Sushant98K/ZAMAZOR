{% extends 'custadmin/components/base.html' %}
{% load static %}


{% block maincontainer %}
     
               <div class="container-fluid">

                    <div class="row">
                         <div class="col-xl-12">
                              <div class="card">
                                   <div class="card-header d-flex justify-content-between align-items-center gap-1">
                                        <h4 class="card-title flex-grow-1">All Product List</h4>

                                        <a href="product-add.html" class="btn btn-sm btn-primary">
                                             Add Product
                                        </a>

                                        <div class="dropdown">
                                             <a href="#" class="dropdown-toggle btn btn-sm btn-outline-light" data-bs-toggle="dropdown" aria-expanded="false">
                                                  This Month
                                             </a>
                                             <div class="dropdown-menu dropdown-menu-end">
                                                  <!-- item-->
                                                  <a href="#!" class="dropdown-item">Download</a>
                                                  <!-- item-->
                                                  <a href="#!" class="dropdown-item">Export</a>
                                                  <!-- item-->
                                                  <a href="#!" class="dropdown-item">Import</a>
                                             </div>
                                        </div>
                                   </div>
                                   {% comment %} <div>
                                        <div class="table-responsive">
                                             <table class="table align-middle mb-0 table-hover table-centered">
                                                  <thead class="bg-light-subtle">
                                                       <tr>
                                                            <th style="width: 20px;">
                                                                 <div class="form-check ms-1">
                                                                      <input type="checkbox" class="form-check-input" id="customCheck1">
                                                                      <label class="form-check-label" for="customCheck1"></label>
                                                                 </div>
                                                            </th>
                                                            <th>Product Image & Name</th>
                                                            <th>Price</th>
                                                            <th>Stock</th>
                                                            <th>Category</th>
                                                            <th>Rating</th>
                                                            <th>Action</th>
                                                       </tr>
                                                  </thead>
                                                  <tbody>

                                                  {% for product in products %}
     
                                                       <tr id="product-row-{{ product.id }}" >
                                                            <td>
                                                                 <div class="form-check ms-1">
                                                                      <input type="checkbox" class="form-check-input" id="customCheck2">
                                                                      <label class="form-check-label" for="customCheck2">&nbsp;</label>
                                                                 </div>
                                                            </td>
                                                            <td>
                                                                 <div class="d-flex align-items-center gap-2">
                                                                      <div class="rounded bg-light avatar-md d-flex align-items-center justify-content-center">
                                                                           <img src="{{ product.product_img.url }}" alt="{{ product.pname }}" class="avatar-md img-fluid" style="object-fit: contain;">
                                                                      </div>
                                                                      <div>
                                                                           <a href="#!" class="text-dark fw-medium fs-15"> {{ product.pname }} </a>
                                                                           <p class="text-muted mb-0 mt-1 fs-13"><span>Tag : </span>{{product.category.shortform}}-0134{{product.id}}</p>
                                                                      </div>
                                                                 </div>

                                                            </td>
                                                            <td>â‚¹{{product.selling_price}} </td>
                                                            <td>
                                                                 <p class="mb-1 text-muted"><span class="text-dark fw-medium">784 Item</span> Left</p>
                                                                 <p class="mb-0 text-muted">674 Sold</p>
                                                            </td>
                                                            <td> {{product.category}} </td>
                                                            <td> <span class="badge p-1 bg-light text-dark fs-12 me-1"><i class="bx bxs-star align-text-top fs-14 text-warning me-1"></i> 4.1</span> 143 Review</td>
                                                            <td>
                                                                 <div class="d-flex gap-2">
                                                                      <a href="#!" class="btn btn-light btn-sm"><iconify-icon icon="solar:eye-broken" class="align-middle fs-18"></iconify-icon></a>
                                                                      <a href="#!" class="btn btn-soft-primary btn-sm"><iconify-icon icon="solar:pen-2-broken" class="align-middle fs-18"></iconify-icon></a>
                                                                      <a href="#!" class="btn btn-soft-danger btn-sm"><iconify-icon icon="solar:trash-bin-minimalistic-2-broken" class="align-middle fs-18"></iconify-icon></a>
                                                                 </div>
                                                            </td>
                                                       </tr>
     
                                                  {% endfor %}
                                                  </tbody>
                                             </table>
                                        </div>
                                        <!-- end table-responsive -->
                                   </div>
                                   <div class="card-footer border-top">
                                        <nav aria-label="Page navigation example">
                                             <ul class="pagination justify-content-end mb-0">
                                                  <li class="page-item"><a class="page-link" href="javascript:void(0);">Previous</a></li>
                                                  <li class="page-item active"><a class="page-link" href="javascript:void(0);">1</a></li>
                                                  <li class="page-item"><a class="page-link" href="javascript:void(0);">2</a></li>
                                                  <li class="page-item"><a class="page-link" href="javascript:void(0);">3</a></li>
                                                  <li class="page-item"><a class="page-link" href="javascript:void(0);">Next</a></li>
                                             </ul>
                                        </nav>
                                   </div> {% endcomment %}

                                   <div>
                                        <div class="table-responsive">
                                             <table class="table align-middle mb-0 table-hover table-centered">
                                                  <thead class="bg-light-subtle">
                                                       <tr>
                                                            <th style="width: 20px;">
                                                            <div class="form-check ms-1">
                                                                 <input type="checkbox" class="form-check-input" id="customCheck1">
                                                                 <label class="form-check-label" for="customCheck1"></label>
                                                            </div>
                                                            </th>
                                                            <th>Product Image & Name</th>
                                                            <th>Price</th>
                                                            <th>Stock</th>
                                                            <th>Category</th>
                                                            <th>Rating</th>
                                                            <th>Action</th>
                                                       </tr>
                                                  </thead>
                                                  <tbody>
                                                       {% for product in page_obj %}
                                                       <tr id="product-row-{{ product.id }}">
                                                            <td>
                                                            <div class="form-check ms-1">
                                                                 <input type="checkbox" class="form-check-input" id="customCheck2">
                                                                 <label class="form-check-label" for="customCheck2">&nbsp;</label>
                                                            </div>
                                                            </td>
                                                            <td>
                                                            <div class="d-flex align-items-center gap-2">
                                                                 <div class="rounded bg-light avatar-md d-flex align-items-center justify-content-center">
                                                                      <img src="{{ product.product_img.url }}" alt="{{ product.pname }}" class="avatar-md img-fluid" style="object-fit: contain;">
                                                                 </div>
                                                                 <div>
                                                                      <a href="#!" class="text-dark fw-medium fs-15">{{ product.pname }}</a>
                                                                      <p class="text-muted mb-0 mt-1 fs-13"><span>Tag : </span>{{ product.category.shortform }}-0134{{ product.id }}</p>
                                                                 </div>
                                                            </div>
                                                            </td>
                                                            <td>â‚¹{{ product.selling_price }}</td>
                                                            <td>
                                                            <p class="mb-1 text-muted"><span class="text-dark fw-medium">784 Item</span> Left</p>
                                                            <p class="mb-0 text-muted">674 Sold</p>
                                                            </td>
                                                            <td>{{ product.category }}</td>
                                                            <td>
                                                            <span class="badge p-1 bg-light text-dark fs-12 me-1"><i class="bx bxs-star align-text-top fs-14 text-warning me-1"></i> 4.1</span> 143 Review
                                                            </td>
                                                            <td>
                                                                 <div class="d-flex gap-2">
                                                                      <a href="{% url 'product-details' product.id %}" class="btn btn-light btn-sm"><iconify-icon icon="solar:eye-broken" class="align-middle fs-18"></iconify-icon></a>
                                                                      <a href="{% url 'product-edit' product.id %}" class="btn btn-soft-primary btn-sm"><iconify-icon icon="solar:pen-2-broken" class="align-middle fs-18"></iconify-icon></a>
                                                                      {% comment %} <a href="#!" class="btn btn-soft-danger btn-sm"><iconify-icon icon="solar:trash-bin-minimalistic-2-broken" class="align-middle fs-18"></iconify-icon></a> {% endcomment %}
                                                                      <a href="#" class="btn btn-soft-danger btn-sm" onclick="showDeletePopup({{ product.id }})">
                                                                           <iconify-icon icon="solar:trash-bin-minimalistic-2-broken" class="align-middle fs-18"></iconify-icon>
                                                                      </a>
                                                                 </div>
                                                            </td>
                                                       </tr>
                                                       {% endfor %}
                                                  </tbody>
                                             </table>
                                        </div>
                                        <!-- end table-responsive -->
                                   </div>

                                   <!-- Delete Confirmation Modal -->
                                                  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                                                       <div class="modal-dialog modal-dialog-centered">
                                                            <div class="modal-content">
                                                                 <div class="modal-header">
                                                                      <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                                                                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                 </div>
                                                                 <div class="modal-body">
                                                                      Are you sure you want to delete this category?
                                                                 </div>
                                                                 <div class="modal-footer">
                                                                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                                      <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
                                                                 </div>
                                                            </div>
                                                       </div>
                                                  </div>

                                   

                              {% comment %} 
                                   This will show all numbers
                                   <div class="card-footer border-top">
                                        <nav aria-label="Page navigation example">
                                             <ul class="pagination justify-content-end mb-0">
                                                  {% if page_obj.has_previous %}
                                                       <li class="page-item">
                                                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
                                                       </li>
                                                  {% else %}
                                                       <li class="page-item disabled">
                                                            <a class="page-link" href="#">Previous</a>
                                                       </li>
                                                  {% endif %}
                                                  
                                                  {% for num in page_obj.paginator.page_range %}
                                                       {% if page_obj.number == num %}
                                                            <li class="page-item active">
                                                            <a class="page-link" href="#">{{ num }}</a>
                                                            </li>
                                                       {% else %}
                                                            <li class="page-item">
                                                            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                                            </li>
                                                       {% endif %}
                                                  {% endfor %}
                                                  
                                                  {% if page_obj.has_next %}
                                                       <li class="page-item">
                                                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
                                                       </li>
                                                  {% else %}
                                                       <li class="page-item disabled">
                                                            <a class="page-link" href="#">Next</a>
                                                       </li>
                                                  {% endif %}
                                             </ul>
                                        </nav>
                                   </div> 
                              {% endcomment %}

                                   <div class="card-footer border-top">
                                        <nav aria-label="Page navigation example">
                                             <ul class="pagination justify-content-end mb-0">
                                                  <!-- Previous Button -->
                                                  {% if page_obj.has_previous %}
                                                       <li class="page-item">
                                                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
                                                       </li>
                                                  {% else %}
                                                       <li class="page-item disabled">
                                                            <a class="page-link" href="#">Previous</a>
                                                       </li>
                                                  {% endif %}

                                                  <!-- Previous Number Button -->
                                                  {% if page_obj.number > 1 %}
                                                       <li class="page-item">
                                                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">{{ page_obj.previous_page_number }}</a>
                                                       </li>
                                                  {% endif %}

                                                  <!-- Current Page Button (Active) -->
                                                  <li class="page-item active">
                                                       <a class="page-link" href="#">{{ page_obj.number }}</a>
                                                  </li>

                                                  <!-- Next Number Button -->
                                                  {% if page_obj.has_next %}
                                                       <li class="page-item">
                                                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">{{ page_obj.next_page_number }}</a>
                                                       </li>
                                                  {% endif %}

                                                  <!-- Next Button -->
                                                  {% if page_obj.has_next %}
                                                       <li class="page-item">
                                                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
                                                       </li>
                                                  {% else %}
                                                       <li class="page-item disabled">
                                                            <a class="page-link" href="#">Next</a>
                                                       </li>
                                                  {% endif %}
                                             </ul>
                                        </nav>
                                   </div>




                              </div>
                         </div>

                    </div>

               </div>

     {% include 'custadmin/components/popup.html' %}

<script>
    let deleteProductId = null;

    function showDeletePopup(productId) {
        deleteProductId = productId;
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        deleteModal.show();
    }

    document.getElementById('confirmDeleteButton').addEventListener('click', function () {
        if (deleteProductId) {
            // Send the delete request via AJAX
            fetch(`/custadmin/product-delete/${deleteProductId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}', // Add CSRF token for security
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload(); // Reload the page to reflect changes
                } else {
                    alert('An error occurred while deleting the category.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    });
</script>


{% endblock maincontainer %}

